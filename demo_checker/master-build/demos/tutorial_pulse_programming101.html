
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta content="Simulating differentialble pulse programs in PennyLane with qubits" property="og:description" />
<meta content="https://pennylane.ai/qml/_images/thumbnail_tutorial_pulse_programming.png" property="og:image" />

  <link rel="icon" type="image/x-icon" href="../_static/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="../_static/favicon.ico">
  


  <meta property="og:title" content="Differentiable pulse programming with qubits in PennyLane &#8212; PennyLane">
  <meta property="og:url" content="https://pennylane.ai/qml/demos/tutorial_pulse_programming101.html">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  
  
  <meta content="Simulating differentialble pulse programs in PennyLane with qubits" property="og:description" />
  

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.14/css/mdb.min.css">
  <!-- NanoScroller -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.nanoscroller/0.8.7/css/nanoscroller.min.css">
  <!-- Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/tomorrow-night.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       "HTML-CSS": { scale: 90, linebreaks: { automatic: true } },
       TeX: {
         Macros: {
           pr : ['|\#1\\rangle\\langle\#1|',1],
           ket: ['\\left| \#1\\right\\rangle',1],
           bra: ['\\left\\langle \#1\\right|',1],
           xket: ['\\left| \#1\\right\\rangle_x',1],
           xbra: ['\\left\\langle \#1\\right|_x',1],
           braket: ['\\langle \#1 \\rangle',1],
           braketD: ['\\langle \#1 \\mid \#2 \\rangle',2],
           braketT: ['\\langle \#1 \\mid \#2 \\mid \#3 \\rangle',3],
           ketbra: ['| #1 \\rangle \\langle #2 |',2],
           hc: ['\\text{h.c.}',0],
           cc: ['\\text{c.c.}',0],
           h: ['\\hat',0],
           nn: ['\\nonumber',0],
           di: ['\\frac{d}{d \#1}',1],
           uu: ['\\mathcal{U}',0],
           inn: ['\\text{in}',0],
           out: ['\\text{out}',0],
           vac: ['\\text{vac}',0],
           I: ['\\hat{\\mathbf{1}}',0],
           x: ['\\hat{x}',0],
           p: ['\\hat{p}',0],
           a: ['\\hat{a}',0],
           ad: ['\\hat{a}^\\dagger',0],
           n: ['\\hat{n}',0],
           nbar: ['\\overline{n}',0],
           sech: ['\\mathrm{sech~}',0],
           tanh: ['\\mathrm{tanh~}',0],
           re: ['\\text{Re}',0],
           im: ['\\text{Im}',0],
           tr: ['\\mathrm{Tr} #1',1],
           sign: ['\\text{sign}',0],
           overlr: ['\\overset\\leftrightarrow{\#1}',1],
           overl: ['\\overset\leftarrow{\#1}',1],
           overr: ['\\overset\rightarrow{\#1}',1],
           avg: ['\\left< \#1 \\right>',1],
           slashed: ['\\cancel{\#1}',1],
           bold: ['\\boldsymbol{\#1}',1],
           d: ['\\mathrm d',0],
           expect: ["\\langle #1 \\rangle",1],
           pde: ["\\frac{\\partial}{\\partial \#1}",1],
           R: ["\\mathbb{R}",0],
           C: ["\\mathbb{C}",0],
           Ad: ["\\text{Ad}",0],
           Var: ["\\text{Var}",0],
           bx: ["\\mathbf{x}", 0],
           bm: ["\\boldsymbol{\#1}",1],
           haf: ["\\mathrm{haf}",0],
           lhaf: ["\\mathrm{lhaf}",0]
         }
       }
     });
     </script>

  <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130507810-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-130507810-1');
      </script>
  
    <title>Differentiable pulse programming with qubits in PennyLane &#8212; PennyLane  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/xanadu.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/light-slider.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/hubs.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="canonical" href="https://pennylane.ai/qml/demos/tutorial_pulse_programming101.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Neutral-atom quantum computers" href="tutorial_neutral_atoms.html" />
    <link rel="prev" title="Introduction to the ZX-calculus" href="tutorial_zx_calculus.html" /> 
  </head><body><nav class="navbar navbar-expand-lg navbar-light white sticky-top">

<!-- Logo and Title -->









  



  <a class="navbar-brand nav-link" href="https://pennylane.ai">
    
  <img class="pr-1" src=" ../_static/logo.png" width="28px"></img>
  
    <img id="navbar-wordmark" src="../_static/pennylane.svg"></img>
  
  </a>


  <!-- [Mobile] Collapse Button -->
  <div class="row right">
    

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav"
      aria-controls="basicExampleNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>

  <!-- [Mobile] Collapsible Content -->
  <div class="collapse navbar-collapse" id="basicExampleNav">

    <!-- Links on the Left -->
    <ul class="navbar-nav mr-auto">
      
        
          
            <li class="nav-item active">
              <a class="nav-link" href="https://pennylane.ai/qml/">
                
  
    Learn
  

              </a>
              <span class="sr-only">(current)</span>
            </li>
          

        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/qml/demonstrations.html">
                
  
    Demos
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/install.html">
                
  
    Install
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/plugins.html">
                
  
    Plugins
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://docs.pennylane.ai">
                
  
    Documentation
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/blog/">
                
  
    Blog
  

            </a>
          </li>
        
      
    </ul>

    <!-- Links on the Right -->
    <ul class="navbar-nav ml-auto nav-flex-icons">
      
        <li class="nav-item">
          <a class="nav-link" href="https://pennylane.ai/faq.html">
            <i class="fas fa-question pr-1"></i> FAQ
          </a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="https://discuss.pennylane.ai/">
            <i class="fab fa-discourse pr-1"></i> Support
          </a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PennyLaneAI/pennylane">
            <i class="fab fa-github pr-1"></i> GitHub
          </a>
        </li>
      

    </ul>
  </div>

</nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_neutral_atoms.html" title="Neutral-atom quantum computers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_zx_calculus.html" title="Introduction to the ZX-calculus"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PennyLane  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../demonstrations.html" >Demos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../demos_quantum-computing.html" accesskey="U">Quantum Computing</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Differentiable pulse programming with qubits in PennyLane</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">
        <div id="content">
          <div id="right-column">
            
            

            <div class="document clearer body">
              
    <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-demos-tutorial-pulse-programming101-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="differentiable-pulse-programming-with-qubits-in-pennylane">
<span id="sphx-glr-demos-tutorial-pulse-programming101-py"></span><h1>Differentiable pulse programming with qubits in PennyLane<a class="headerlink" href="#differentiable-pulse-programming-with-qubits-in-pennylane" title="Permalink to this headline">¶</a></h1>
<p><script type="text/javascript">
    var related_tutorials = ["ahs_aquila.html"];
    var related_tutorials_titles = ['Pulse programming on neutral atom hardware'];
</script></p>
<p>Author: Korbinian Kottmann — Posted: 8 March 2023.</p>
<p>Quantum computers perform gates via electromagnetic pulses on the hardware level. In differentiable pulse programming, we
can write quantum algorithms directly on the hardware level and variationally optimize the shape, phase and amplitude of the interactions
for our desired goals.
In this demo, we are going to introduce pulse programming with qubits in PennyLane and run the
ctrl-VQE algorithm <a class="footnote-reference brackets" href="#mitei" id="id1">1</a> on a two-qubit Hamiltonian for the <span class="math notranslate nohighlight">\(\text{HeH}^+\)</span> molecule.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference external image-reference" href="javascript:void(0)"><img alt="../_images/pulse_illustration.png" src="../_images/pulse_illustration.png" style="width: 50%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="pulses-in-quantum-computers">
<h2>Pulses in quantum computers<a class="headerlink" href="#pulses-in-quantum-computers" title="Permalink to this headline">¶</a></h2>
<p>In many quantum computing architectures such as <a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_sc_qubits.html">superconducting</a>, <a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_trapped_ions.html">ion trap</a>
and <a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_pasqal.html">neutral atom Rydberg</a> systems,
qubits are realized through physical systems with a discrete set of energy levels.
For example, transmon qubits realize an anharmonic oscillator whose ground and first excited states can serve as the two energy
levels of a qubit. Such a qubit can be controlled via an electromagnetic field tuned to its energy gap. In general, this
electromagnetic field can be altered in time, leading to a time-dependent Hamiltonian <span class="math notranslate nohighlight">\(H(t)\)</span> describing the effect of the field on the qubits.
We call driving the system with such an electromagnetic field for a fixed time window <span class="math notranslate nohighlight">\([t_0, t_1]\)</span> a <em>pulse sequence</em>.
During a pulse sequence, the state evolves according to the time-dependent Schrödinger equation</p>
<div class="math notranslate nohighlight">
\[\frac{d}{dt}|\psi\rangle = -i H(t) |\psi\rangle\]</div>
<p>from an initial state <span class="math notranslate nohighlight">\(|\psi(t_0)\rangle\)</span> to a final state <span class="math notranslate nohighlight">\(|\psi(t_1)\rangle\)</span>. This process corresponds to a unitary evolution <span class="math notranslate nohighlight">\(U(t_0, t_1)\)</span>
of the input state from time <span class="math notranslate nohighlight">\(t_0\)</span> to <span class="math notranslate nohighlight">\(t_1\)</span>, i.e. <span class="math notranslate nohighlight">\(|\psi(t_1)\rangle = U(t_0, t_1) |\psi(t_0)\rangle\)</span>.</p>
<p>In most digital quantum computers (with the exception of <a class="reference external" href="https://pennylane.ai/qml/demos/tutorial_mbqc.html">measurement-based</a> architectures), the amplitude and frequencies of predefined pulse sequences are
fine tuned to realize the native gates of the quantum computer. More specifically, the Hamiltonian interaction <span class="math notranslate nohighlight">\(H(t)\)</span>
is tuned such that the respective evolution <span class="math notranslate nohighlight">\(U(t_0, t_1)\)</span> realizes for example a Pauli or CNOT gate (see e.g. <em>cross-resonance</em> gates for superconducting qubits in <a class="footnote-reference brackets" href="#sheldon2016" id="id2">2</a>).</p>
</div>
<div class="section" id="pulse-programming-in-pennylane">
<h2>Pulse programming in PennyLane<a class="headerlink" href="#pulse-programming-in-pennylane" title="Permalink to this headline">¶</a></h2>
<p>A user of a quantum computer typically operates on the higher and more abstract gate level.
Future fault-tolerant quantum computers require this abstraction to allow for error correction.
For noisy and intermediate-sized quantum computers, the abstraction of decomposing quantum algorithms
into a fixed native gate set can be a hindrance and unnecessarily increase execution time, therefore leading
to more noise in the computation. The idea of differentiable pulse programming is to optimize quantum circuits on the pulse
level instead, with the aim of achieving the shortest interaction sequence a hardware system allows.</p>
<p>In PennyLane, we can simulate arbitrary qubit system interactions to explore the possibilities of such pulse programs.
First, we need to define the time-dependent Hamiltonian <span class="math notranslate nohighlight">\(H(p, t)= \sum_i f_i(p_i, t) H_i\)</span> with constant operators <span class="math notranslate nohighlight">\(H_i\)</span> and control fields <span class="math notranslate nohighlight">\(f_i(p_i, t)\)</span>.
The Hamiltonian depends on the set of parameters <span class="math notranslate nohighlight">\(p = \{p_i\}\)</span>. One way to do this in PennyLane is in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>
<span class="kn">import</span> <span class="nn">pennylane.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set to float64 precision and remove jax CPU/GPU warning</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_platform_name&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># polyval(p, t) evaluates a polynomial of degree N=len(p)</span>
    <span class="c1"># i.e. p[0]*t**(N-1) + p[1]*t**(N-2) + ... + p[N-2]*t + p[N-1]</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a> <span class="o">=</span> <span class="n">f1</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">f2</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliY.html#pennylane.PauliY" title="pennylane.PauliY" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliY</span></a><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>This constructs a <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParametrizedHamiltonian</span></code></a>. Note that the <code class="docutils literal notranslate"><span class="pre">callable</span></code> functions <code class="docutils literal notranslate"><span class="pre">f1</span></code> and <code class="docutils literal notranslate"><span class="pre">f2</span></code>
are expected to have the fixed signature <code class="docutils literal notranslate"><span class="pre">(p,</span> <span class="pre">t)</span></code>. When calling the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParametrizedHamiltonian</span></code></a>,
a <code class="docutils literal notranslate"><span class="pre">tuple</span></code> or <code class="docutils literal notranslate"><span class="pre">list</span></code> of the parameters for each of the functions is passed in the same
order the Hamiltonian was constructed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>              <span class="c1"># parameters for f1</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span> <span class="c1"># parameters for f2</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.5</span>                       <span class="c1"># some fixed point in time</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="n">t</span><span class="p">))</span>        <span class="c1"># order of parameters p1, p2 matters</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(1.9375*(PauliX(wires=[0]))) + (1.0*(PauliY(wires=[1])))
</pre></div>
</div>
<p>We can construct general Hamiltonians of the form <span class="math notranslate nohighlight">\(\sum_i H_i^d + \sum_i f_i(p_i, t) H_i\)</span>
using <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">qml.dot</span></code></a>. Such a time-dependent Hamiltonian consists of time-independent drift terms <span class="math notranslate nohighlight">\(H_i^d\)</span>
and time-dependent control terms <span class="math notranslate nohighlight">\(f_i(p_i, t) H_i\)</span> with scalar complex-valued functions <span class="math notranslate nohighlight">\(f_i(p, t).\)</span>
In the following we are going to construct <span class="math notranslate nohighlight">\(\sum_i X_i X_{i+1} + \sum_i f_i(p_i, t) Z_i\)</span> with <span class="math notranslate nohighlight">\(f_i(p_i, t) = \sin(p_i^0 t) + \sin(p_i^1 t) \forall i\)</span> as an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">coeffs</span> <span class="o">+=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">@</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">ops</span> <span class="o">+=</span> <span class="p">[</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="pennylane.PauliZ" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span></a><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="pennylane.dot" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">ops</span><span class="p">)</span>

<span class="c1"># random coefficients</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">777</span><span class="p">)</span>
<span class="n">subkeys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># create list of 3 subkeys</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">subkeys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">maxval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>((1.0*(PauliX(wires=[0]) @ PauliX(wires=[1]))) + (1.0*(PauliX(wires=[1]) @ PauliX(wires=[2])))) + (((1.4456867348869746*(PauliZ(wires=[0]))) + (1.823824746247098*(PauliZ(wires=[1])))) + (1.8206871129031437*(PauliZ(wires=[2]))))
</pre></div>
</div>
<p>We can visualize the Hamiltonian interaction by plotting the time-dependent envelopes. We refer to the drift term as all constant terms in time, i.e. <span class="math notranslate nohighlight">\(\sum_i X_i X_{i+1}\)</span>,
and plot the envelopes <span class="math notranslate nohighlight">\(f_i(p_i, t)\)</span> of the time-dependent terms <span class="math notranslate nohighlight">\(f_i(p_i, t) Z_i\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a><span class="o">.</span><span class="n">coeffs_parametrized</span>
<span class="n">ops</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a><span class="o">.</span><span class="n">ops_parametrized</span>
<span class="n">n_channels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_channels</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hspace&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">fs</span><span class="p">[</span><span class="n">n</span><span class="p">](</span><span class="n">params</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">ts</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$f_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Envelopes $f_i(p_i, t)$ of $\sum_i X_i X_</span><span class="se">{{</span><span class="s2">i+1</span><span class="se">}}</span><span class="s2"> + \sum_i f_i(p_i, t) Z_i$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time t&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_pulse_programming101_001.png" srcset="../_images/sphx_glr_tutorial_pulse_programming101_001.png" alt="Envelopes $f_i(p_i, t)$ of $\sum_i X_i X_{i+1} + \sum_i f_i(p_i, t) Z_i$" class = "sphx-glr-single-img"/><p>A pulse program is then executed by using the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.evolve.html#pennylane.evolve" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code></a> transform to create the evolution
gate <span class="math notranslate nohighlight">\(U(t_0, t_1)\)</span>, which implicitly depends on the parameters <code class="docutils literal notranslate"><span class="pre">p</span></code>. The objective of the program
is then to compute the expectation value of some objective Hamiltonian <code class="docutils literal notranslate"><span class="pre">H_obj</span></code> (here <span class="math notranslate nohighlight">\(\sum_i Z_i\)</span> as a simple example).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit_jax.DefaultQubitJax.html#pennylane.devices.default_qubit_jax.DefaultQubitJax" title="pennylane.devices.default_qubit_jax.DefaultQubitJax" class="sphx-glr-backref-module-pennylane-devices-default_qubit_jax sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dev</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="pennylane.device" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">device</span></a><span class="p">(</span><span class="s2">&quot;default.qubit.jax&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_obj</span></a> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="pennylane.PauliZ" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span></a><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="nd">@qml</span><span class="o">.</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit_jax.DefaultQubitJax.html#pennylane.devices.default_qubit_jax.DefaultQubitJax" title="pennylane.devices.default_qubit_jax.DefaultQubitJax" class="sphx-glr-backref-module-pennylane-devices-default_qubit_jax sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dev</span></a><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;jax&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">qnode</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.evolve.html#pennylane.evolve" title="pennylane.evolve" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">evolve</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Ht</span></a><span class="p">)(</span><span class="n">params</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
    <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_obj</span></a><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.017290111149849463
</pre></div>
</div>
<p>We used the decorator <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> to compile this execution just-in-time. This means the first execution will typically take a little longer with the
benefit that all following executions will be significantly faster, see the <a class="reference external" href="https://jax.readthedocs.io/en/latest/jax-101/02-jitting.html">jax docs on jitting</a>.
Note that when removing the <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> decorator, the numerical solver <a class="reference external" href="https://github.com/google/jax/blob/main/jax/experimental/ode.py">odeint</a> for the time evolution
inside <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.evolve.html#pennylane.evolve" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code></a> is still jit-compiled by default.</p>
<p>Researchers interested in more specific hardware systems can simulate them using the specific Hamiltonian interactions.
For example, we will simulate a transmon qubit system in the ctrl-VQE example in the last section of this demo.</p>
</div>
<div class="section" id="gradients-of-pulse-programs">
<h2>Gradients of pulse programs<a class="headerlink" href="#gradients-of-pulse-programs" title="Permalink to this headline">¶</a></h2>
<p>Internally, pulse programs in PennyLane solve the time-dependent Schrödinger equation using the <a class="reference external" href="https://en.wikipedia.org/wiki/Dormand%E2%80%93Prince_method">Dopri5</a> solver for
ordinary differential equations (ODEs). In particular, the step sizes between <span class="math notranslate nohighlight">\(t_0\)</span> and <span class="math notranslate nohighlight">\(t_1\)</span> are chosen adaptively to stay within a given error tolerance.
We can backpropagate through this ODE solver and obtain the gradient via <code class="docutils literal notranslate"><span class="pre">jax.grad</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">)(</span><span class="n">params</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[Array([0.16856194, 0.54566721], dtype=float64), Array([-0.03072272,  0.06945655], dtype=float64), Array([-0.12911106, -0.00694706], dtype=float64)]
</pre></div>
</div>
<p>Alternatively, one could consider computing the gradient with the parameter shift rule <a class="footnote-reference brackets" href="#leng2022" id="id3">3</a>, which is particularly interesting for
real hardware execution. In classical simulations, however, backpropagation is recommended.</p>
</div>
<div class="section" id="piecewise-constant-parametrizations">
<h2>Piecewise-constant parametrizations<a class="headerlink" href="#piecewise-constant-parametrizations" title="Permalink to this headline">¶</a></h2>
<p>PennyLane also provides a variety of convenience functions to create, for example, piece-wise-constant parametrizations
defining the function values at fixed time bins as parameters. We can construct such a callable with <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.pwc.html#pennylane.pulse.pwc" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pwc()</span></code></a>
by providing a <code class="docutils literal notranslate"><span class="pre">timespan</span></code> argument which is expected to be either a total time (<code class="docutils literal notranslate"><span class="pre">float</span></code>) or a start and end time (<code class="docutils literal notranslate"><span class="pre">tuple</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timespan</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.pwc.html#pennylane.pulse.pwc" title="pennylane.pulse.pwc" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">pulse</span><span class="o">.</span><span class="n">pwc</span></a><span class="p">(</span><span class="n">timespan</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
<p>This creates a callable with signature <code class="docutils literal notranslate"><span class="pre">(p,</span> <span class="pre">t)</span></code> that returns <code class="docutils literal notranslate"><span class="pre">p[int(len(p)*t/duration)]</span></code>, such that the passed parameters are the function values
for different time bins.
Note how the number of time bins is implicitly defined through the length of the parameters. In the following example, we are going to use
<code class="docutils literal notranslate"><span class="pre">4</span></code> and <code class="docutils literal notranslate"><span class="pre">10</span></code> time bins defined through the length of parameters, respectively. Let us create uniformly random parameters between 0 and 5 and plot
the corresponding piece-wise-constant function sampled at <code class="docutils literal notranslate"><span class="pre">100</span></code> different points in time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">777</span><span class="p">)</span>
<span class="n">subkeys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># creates a list of two sub-keys</span>
<span class="n">theta0</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">subkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">maxval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">theta1</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">subkeys</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">maxval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span><span class="p">]</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">timespan</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">),</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coeffs[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time t&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_pulse_programming101_002.png" srcset="../_images/sphx_glr_tutorial_pulse_programming101_002.png" alt="tutorial pulse programming101" class = "sphx-glr-single-img"/><p>We can use these callables as before to construct a <code class="xref py py-func docutils literal notranslate"><span class="pre">ParametrizedHamiltonian()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">pulse</span><span class="o">.</span><span class="n">ParametrizedHamiltonian</span></a><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">ops</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(3.31518202727953*(PauliX(wires=[0]))) + (1.817160952485034*(PauliX(wires=[1])))
</pre></div>
</div>
<p>Note that this construction is equivalent to using <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">qml.dot</span></code></a>.</p>
</div>
<div class="section" id="variational-quantum-eigensolver-with-pulse-programming">
<h2>Variational quantum eigensolver with pulse programming<a class="headerlink" href="#variational-quantum-eigensolver-with-pulse-programming" title="Permalink to this headline">¶</a></h2>
<p>We can now use the ability to access gradients to perform the variational quantum eigensolver on the pulse level (ctrl-VQE) as is done in <a class="footnote-reference brackets" href="#mitei" id="id4">1</a>.
For a more general introduction to VQE, see <a class="reference internal" href="tutorial_vqe.html"><span class="doc">A brief overview of VQE</span></a>.
First, we define the molecular Hamiltonian whose energy expectation value we want to minimize. This serves as our objective Hamiltonian.
We are using <span class="math notranslate nohighlight">\(\text{HeH}^+\)</span> as a simple example and load it from the <a class="reference external" href="https://pennylane.ai/qml/datasets.html">PennyLane quantum datasets</a> website.
We are going to use the tapered Hamiltonian, which makes use of symmetries to reduce the number of qubits, see <a class="reference internal" href="tutorial_qubit_tapering.html"><span class="doc">Qubit tapering</span></a> for details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.data.Dataset.html#pennylane.data.Dataset" title="pennylane.data.Dataset" class="sphx-glr-backref-module-pennylane-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.data.load.html#pennylane.data.load" title="pennylane.data.load" class="sphx-glr-backref-module-pennylane-data sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span></a><span class="p">(</span><span class="s2">&quot;qchem&quot;</span><span class="p">,</span> <span class="n">molname</span><span class="o">=</span><span class="s2">&quot;HeH+&quot;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;STO-3G&quot;</span><span class="p">,</span> <span class="n">bondlength</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_obj</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span><span class="o">.</span><span class="n">tapered_hamiltonian</span></a>

<span class="c1"># casting the Hamiltonian coefficients to a jax Array</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_obj</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">Hamiltonian</span></a><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian.coeffs" title="pennylane.Hamiltonian.coeffs" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-attribute"><span class="n">H_obj</span><span class="o">.</span><span class="n">coeffs</span></a><span class="p">),</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian.ops" title="pennylane.Hamiltonian.ops" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-attribute"><span class="n">H_obj</span><span class="o">.</span><span class="n">ops</span></a><span class="p">)</span>
<span class="n">E_exact</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.data.Dataset.html#pennylane.data.Dataset" title="pennylane.data.Dataset" class="sphx-glr-backref-module-pennylane-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a><span class="o">.</span><span class="n">fci_energy</span>
<span class="n">n_wires</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian.wires" title="pennylane.Hamiltonian.wires" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-attribute"><span class="n">H_obj</span><span class="o">.</span><span class="n">wires</span></a><span class="p">)</span>
</pre></div>
</div>
<p>As a realistic physical system with pulse level control, we are considering a coupled transmon qubit system with the constant drift term Hamiltonian</p>
<div class="math notranslate nohighlight">
\[H_D = \sum_q \omega_q a_q^\dagger a_q - \sum_q \frac{\delta_q}{2} a^\dagger_q a^\dagger_q a_q a_q + \sum_{\langle pq \rangle} g_{pq} a^\dagger_p a_q\]</div>
<p>with bosonic creation and annihilation operators. The anharmonicity <span class="math notranslate nohighlight">\(\delta_q\)</span> is describing the contribution to higher energy levels.
We are only going to consider the qubit subspace and hence set this term to zero.
The order of magnitude of the resonance frequencies <span class="math notranslate nohighlight">\(\omega_q\)</span> and coupling strength <span class="math notranslate nohighlight">\(g_{pq}\)</span> are taken from <a class="footnote-reference brackets" href="#mitei" id="id5">1</a> (in GHz).
Let us construct the Hamiltonian in PennyLane:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">wires</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliY.html#pennylane.PauliY" title="pennylane.PauliY" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliY</span></a><span class="p">(</span><span class="n">wires</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ad</span><span class="p">(</span><span class="n">wires</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliY.html#pennylane.PauliY" title="pennylane.PauliY" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliY</span></a><span class="p">(</span><span class="n">wires</span><span class="p">)</span>

<span class="n">omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.8080</span><span class="p">,</span> <span class="mf">4.8333</span><span class="p">])</span>
<span class="n">g</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01831</span><span class="p">,</span> <span class="mf">0.02131</span><span class="p">])</span>

<span class="n">H_D</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="pennylane.dot" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="p">[</span><span class="n">ad</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">@</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)])</span>
<span class="n">H_D</span> <span class="o">+=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="pennylane.dot" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span>
    <span class="n">g</span><span class="p">,</span> <span class="p">[</span><span class="n">ad</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">@</span> <span class="n">a</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_wires</span><span class="p">)</span> <span class="o">+</span> <span class="n">ad</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_wires</span><span class="p">)</span> <span class="o">@</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The system is driven under the control term</p>
<div class="math notranslate nohighlight">
\[H_C(t) = \sum_q \Omega_q(t) \left(e^{i\nu_q t} a_q + e^{-i\nu_q t} a^\dagger_q \right)\]</div>
<p>with the (real) time-dependent amplitudes <span class="math notranslate nohighlight">\(\Omega_q(t)\)</span> and frequencies <span class="math notranslate nohighlight">\(\nu_q\)</span> of the drive.
We let <span class="math notranslate nohighlight">\(\Omega(t)\)</span> be a real piecewise-constant function whose values are optimized.
In a transmon qubit systems, entangling gates such as <code class="docutils literal notranslate"><span class="pre">CNOT</span></code> are realized by driving a target qubit with the resonance frequency of the control qubit.
This is referred to as cross resonance and is described in <a class="footnote-reference brackets" href="#sheldon2016" id="id6">2</a>.
Here, we allow for more general two-qubit interactions by training the drive frequency <span class="math notranslate nohighlight">\(\nu_q\)</span> on each qubit.</p>
<p>For this drive, there are certain restrictions by the hardware that we want to already account for to make our simulation as realistic as possible.
We therefore restrict the amplitude to <span class="math notranslate nohighlight">\(\pm 20 \text{MHz}\)</span> and the frequency deviation <span class="math notranslate nohighlight">\(\Delta \nu_q = \omega_q - \nu_q\)</span> to <span class="math notranslate nohighlight">\(\pm 1 \text{GHz}\)</span>
(as is done in <a class="footnote-reference brackets" href="#mitei" id="id7">1</a>). We achieve this by normalizing the respective quantities with a shifted sigmoid <span class="math notranslate nohighlight">\(\mathcal{N}(x) = \frac{1 - e^{-x}}{1 + e^{-x}}\)</span>,
which ensures differentiability.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Differentiable normalization to +/- 1 outputs (shifted sigmoid)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Because ParametrizedHamiltonian expects each callable function to have the signature</span>
<span class="c1"># f(p, t) but we have additional parameters it depends on, we create a wrapper function</span>
<span class="c1"># that constructs the callables with the appropriate parameters imprinted on them</span>
<span class="k">def</span> <span class="nf">drive_field</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># The first len(p)-1 values of the trainable params p characterize the pwc function</span>
        <span class="n">amp</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.pwc.html#pennylane.pulse.pwc" title="pennylane.pulse.pwc" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">pulse</span><span class="o">.</span><span class="n">pwc</span></a><span class="p">(</span><span class="n">T</span><span class="p">)(</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>
        <span class="c1"># The amplitude is normalized to maximally reach +/-20MHz (0.02GHz)</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="mf">0.02</span><span class="o">*</span><span class="n">normalize</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>

        <span class="c1"># The last value of the trainable params p provides the drive frequency deviation</span>
        <span class="c1"># We normalize as the difference to drive can maximally be +/-1 GHz</span>
        <span class="n">d_angle</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sign</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">omega</span> <span class="o">+</span> <span class="n">d_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">phase</span>

    <span class="k">return</span> <span class="n">wrapped</span>

<span class="n">duration</span> <span class="o">=</span> <span class="mf">15.0</span>

<span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">drive_field</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)]</span>
<span class="n">fs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">drive_field</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)]</span>
<span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)]</span>
<span class="n">ops</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ad</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">)]</span>

<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_C</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.dot.html#pennylane.dot" title="pennylane.dot" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ops</span><span class="p">)</span>
</pre></div>
</div>
<p>Overall, we end up with the time-dependent parametrized Hamiltonian <span class="math notranslate nohighlight">\(H(p, t) = H_D + H_C(p, t)\)</span>
under which the system is evolved for the given time window of <code class="docutils literal notranslate"><span class="pre">15ns</span></code>. Note that we are expressing time
in nanoseconds (<span class="math notranslate nohighlight">\(10^{-9}\)</span> s) and frequencies (and energies) in gigahertz (<span class="math notranslate nohighlight">\(10^{9}\)</span> Hz), such that both
exponents cancel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_pulse</span></a> <span class="o">=</span> <span class="n">H_D</span> <span class="o">+</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_C</span></a>
</pre></div>
</div>
<p>Now we define the <code class="docutils literal notranslate"><span class="pre">qnode</span></code> that computes the expectation value of the molecular Hamiltonian.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit_jax.DefaultQubitJax.html#pennylane.devices.default_qubit_jax.DefaultQubitJax" title="pennylane.devices.default_qubit_jax.DefaultQubitJax" class="sphx-glr-backref-module-pennylane-devices-default_qubit_jax sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dev</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="pennylane.device" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">device</span></a><span class="p">(</span><span class="s2">&quot;default.qubit.jax&quot;</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>

<span class="nd">@qml</span><span class="o">.</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit_jax.DefaultQubitJax.html#pennylane.devices.default_qubit_jax.DefaultQubitJax" title="pennylane.devices.default_qubit_jax.DefaultQubitJax" class="sphx-glr-backref-module-pennylane-devices-default_qubit_jax sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dev</span></a><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;jax&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">qnode</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">duration</span><span class="p">):</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.BasisState.html#pennylane.BasisState" title="pennylane.BasisState" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">BasisState</span></a><span class="p">(</span><span class="nb">list</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span><span class="o">.</span><span class="n">tapered_hf_state</span></a><span class="p">),</span> <span class="n">wires</span><span class="o">=</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian.wires" title="pennylane.Hamiltonian.wires" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-attribute"><span class="n">H_obj</span><span class="o">.</span><span class="n">wires</span></a><span class="p">)</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.evolve.html#pennylane.evolve" title="pennylane.evolve" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">evolve</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.pulse.ParametrizedHamiltonian.html#pennylane.pulse.ParametrizedHamiltonian" title="pennylane.pulse.ParametrizedHamiltonian" class="sphx-glr-backref-module-pennylane-pulse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_pulse</span></a><span class="p">)(</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">theta</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H_obj</span></a><span class="p">)</span>

<span class="n">value_and_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">))</span>
</pre></div>
</div>
<p>We now have all the ingredients to run our ctrl-VQE program. We use the <code class="docutils literal notranslate"><span class="pre">adam</span></code> implementation in <a class="reference external" href="https://optax.readthedocs.io/en/latest/">optax</a>,
a package for optimizations in <code class="docutils literal notranslate"><span class="pre">jax</span></code>.</p>
<p>It has been shown that the loss landscapes of pulse programs are trap-free for a variety of conditions and loss functions, including ours <a class="footnote-reference brackets" href="#russell2016" id="id8">5</a>.
In practice however, we see that the optimization is senstive to the initial values of the parameters and the optimization strategy.
In particular, we often find ourselves with very slow progress during optimization, indicating wide flat regions in the loss landscape.
This can be salvaged by increasing the learning rate. Sometimes, it proved advantageous to increase the learning rate after an
initial finer search for a better starting point. Further, we note that with the increase in the number of parameters due to the continuous evolution,
the optimization becomes harder.</p>
<p>Whether or not that is due to the increased parameter search space or an inherent effect of pulse programs like barren plateaus in variational quantum circuits
is to be determined in future work.</p>
<p>We systematically tried a variety of combinations of learning rate schedule, optimizer, and initial values. Here, we provide one possible choice leading to good results.</p>
<p>We choose <code class="docutils literal notranslate"><span class="pre">t_bins</span> <span class="pre">=</span> <span class="pre">100</span></code> segments for the piece-wise-constant parametrization of the pulses.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_bins</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># number of time bins</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_wires</span><span class="p">,</span> <span class="n">t_bins</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>

<span class="kn">import</span> <span class="nn">optax</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># The following block creates a constant schedule of the learning rate</span>
<span class="c1"># that increases from 0.1 to 0.5 after 10 epochs</span>
<span class="n">schedule0</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">constant_schedule</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">)</span>
<span class="n">schedule1</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">constant_schedule</span><span class="p">(</span><span class="mf">5e-1</span><span class="p">)</span>
<span class="n">schedule</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">join_schedules</span><span class="p">([</span><span class="n">schedule0</span><span class="p">,</span> <span class="n">schedule1</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
<span class="n">opt_state</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">qnode</span></a><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gradients</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>

<span class="c1">## Compile the evaluation and gradient function and report compilation time</span>
<span class="n">time0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">value_and_grad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="n">time1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grad and val compilation time: </span><span class="si">{</span><span class="n">time1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">## Optimization loop</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
    <span class="n">val</span><span class="p">,</span> <span class="n">grad_circuit</span> <span class="o">=</span> <span class="n">value_and_grad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">updates</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grad_circuit</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">apply_updates</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>

    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy</span></a><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gradients</span></a><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">grad_circuit</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">n_epochs</span><span class="si">}</span><span class="s2">; energy discrepancy: </span><span class="si">{</span><span class="n">val</span><span class="o">-</span><span class="n">E_exact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean grad: </span><span class="si">{</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gradients</span></a><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>grad and val compilation time: 0:00:05.663557
1 / 60; energy discrepancy: 0.002643895599556245
mean grad: 6.611874935388369e-05
11 / 60; energy discrepancy: 0.0013624788499844165
mean grad: 7.076161010608539e-06
21 / 60; energy discrepancy: 0.0011916996770380273
mean grad: 1.54052502618929e-05
31 / 60; energy discrepancy: 0.0008795340397451668
mean grad: 3.746584589026076e-05
41 / 60; energy discrepancy: 0.000517989427401222
mean grad: 8.726890515720664e-06
51 / 60; energy discrepancy: 0.00044829395927026283
mean grad: 1.3015068890424515e-05
</pre></div>
</div>
<p>We see that we have converged to chemical accuracy after half the number of epochs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">energy</span></a><span class="p">)</span> <span class="o">-</span> <span class="n">E_exact</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <span class="s2">&quot;.:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">langle H_{{obj}}</span><span class="se">\\</span><span class="s2">rangle - E_{{FCI}}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">)],</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3e-4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;chem acc.&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy ($E_H$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_pulse_programming101_003.png" srcset="../_images/sphx_glr_tutorial_pulse_programming101_003.png" alt="tutorial pulse programming101" class = "sphx-glr-single-img"/><p>We can also visualize the envelopes for each qubit in time.
We only plot the real amplitude <span class="math notranslate nohighlight">\(\Omega(t)\)</span> and indicate the deviation
<span class="math notranslate nohighlight">\(\Delta \nu_q = \omega_q - \nu_q\)</span> of the drive frequency <span class="math notranslate nohighlight">\(\nu_q\)</span> from the qubit frequency <span class="math notranslate nohighlight">\(\omega_q\)</span>
in the labels.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">n_wires</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">t_bins</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_channels</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Delta </span><span class="se">\\</span><span class="s2">nu_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">$: </span><span class="si">{</span><span class="n">normalize</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.3</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mf">0.02</span><span class="o">*</span><span class="n">normalize</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;.:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$amp_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">$ (GHz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;t (ns)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_pulse_programming101_004.png" srcset="../_images/sphx_glr_tutorial_pulse_programming101_004.png" alt="tutorial pulse programming101" class = "sphx-glr-single-img"/><p>Note that we obtain bang-bang like solutions as indicated in <a class="footnote-reference brackets" href="#asthana2022" id="id9">4</a>, making it
likely we are close to the minimal evolution time with <code class="docutils literal notranslate"><span class="pre">15ns</span></code>.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Pulse programming is an exciting new field within noisy quantum computing. By skipping the digital abstraction, one can
write variational programs on the hardware level, potentially minimizing the computation time. Ideally, this allows for effectively deeper
circuits on noisy hardware.
On the other hand, the possibility to continuously vary the Hamiltonian interaction in time significantly increases
the parameter space. A good parametrization trading off flexibility and the number of parameters is therefore necessary as systems scale up.
Further, the increased flexibility also affects the search space in Hilbert space that pulse gates can reach.
Barren plateaus in variational quantum algorithms are typically due to a lack of a good inductive bias in the ansatz, i.e. having a search space that is too large.
It is therefore crucial to find physically motivated ansätze for pulse programs.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="mitei"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>,<a href="#id5">3</a>,<a href="#id7">4</a>)</span></dt>
<dd><p>Oinam Romesh Meitei, Bryan T. Gard, George S. Barron, David P. Pappas, Sophia E. Economou, Edwin Barnes, Nicholas J. Mayhall
“Gate-free state preparation for fast variational quantum eigensolver simulations: ctrl-VQE”
<a class="reference external" href="https://arxiv.org/abs/2008.04302">arXiv:2008.04302</a>, 2020</p>
</dd>
<dt class="label" id="sheldon2016"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id6">2</a>)</span></dt>
<dd><p>Sarah Sheldon, Easwar Magesan, Jerry M. Chow, Jay M. Gambetta
“Procedure for systematically tuning up crosstalk in the cross resonance gate”
<a class="reference external" href="https://arxiv.org/abs/1603.04821">arXiv:1603.04821</a>, 2016.</p>
</dd>
<dt class="label" id="leng2022"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Jiaqi Leng, Yuxiang Peng, Yi-Ling Qiao, Ming Lin, Xiaodi Wu
“Differentiable Analog Quantum Computing for Optimization and Control”
<a class="reference external" href="https://arxiv.org/abs/2210.15812">arXiv:2210.15812</a>, 2022</p>
</dd>
<dt class="label" id="asthana2022"><span class="brackets"><a class="fn-backref" href="#id9">4</a></span></dt>
<dd><p>Ayush Asthana, Chenxu Liu, Oinam Romesh Meitei, Sophia E. Economou, Edwin Barnes, Nicholas J. Mayhall
“Minimizing state preparation times in pulse-level variational molecular simulations”
<a class="reference external" href="https://arxiv.org/abs/2203.06818">arXiv:2203.06818</a>, 2022.</p>
</dd>
<dt class="label" id="russell2016"><span class="brackets"><a class="fn-backref" href="#id8">5</a></span></dt>
<dd><p>Benjamin Russell, Herschel Rabitz, Rebing Wu
“Quantum Control Landscapes Are Almost Always Trap Free”
<a class="reference external" href="https://arxiv.org/abs/1608.06198">arXiv:1608.06198</a>, 2016.</p>
</dd>
</dl>
</div>
<div class="section" id="about-the-author">
<h2>About the author<a class="headerlink" href="#about-the-author" title="Permalink to this headline">¶</a></h2>
<div class="bio" >
    <div class="photo" >
        <img class="photo__img" src="../_static/authors/korbinian_kottmann.jpg" alt="Korbinian Kottmann" >
    </div>
    <div class="bio-text">
        <h4 class="bio-text__author-name">Korbinian Kottmann</h4>
        <p class="bio-text__author-description">Korbinian is a Quantum Scientist at Xanadu, interested in quantum simulation and quantum software.</p>
    </div>
</div><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  5.924 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-demos-tutorial-pulse-programming101-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b1b9fcf500877c75e37d8b59e756c5f4/tutorial_pulse_programming101.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tutorial_pulse_programming101.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/42a865e3c5e91683670078ee821c46d6/tutorial_pulse_programming101.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tutorial_pulse_programming101.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    <script type="text/javascript">
        // This script ensures that the active navbar entry switches
        // from 'QML' to 'Demos' for any webpage within the demos/ directory,
        // or for any of the demonstration landing pages
        // (e.g., demos_optimization).
        var pagename = document.location.href.match(/[^\/]+$/)[0];
        var dir = document.URL.substr(0,document.URL.lastIndexOf('/')).match(/[^\/]+$/)[0];

        if (pagename.includes("demos") || pagename.includes("demonstrations") || dir.includes("demos")) {

            $(".nav-item.active").removeClass("active");
            var demos_link = $('.navbar-nav a').filter(function(index) { return $(this).text() === "Demos"; })[0]
            $(demos_link).parent().addClass("active");
        }
    </script>

              <div id="bottom-dl" class="xanadu-call-to-action-links">
                <div id="tutorial-type">demos/tutorial_pulse_programming101</div>
                <div class="download-python-link">
                  <i class="fab fa-python"></i>&nbsp;
                  <div class="call-to-action-desktop-view">Download Python script</div>
                </div>
                <div class="download-notebook-link">
                  <i class="fas fa-download"></i>&nbsp;
                  <div class="call-to-action-desktop-view">Download Notebook</div>
                </div>
                <div class="github-view-link">
                  <i class="fab fa-github"></i>&nbsp;
                  <div class="call-to-action-desktop-view">View on GitHub</div>
                </div>
              </div>

            </div>
            
          </div>
        
<div class="localtoc-container nano has-scrollbar">
  <div class="nano-content">
    <div id="localtoc">
        
          <h3>Contents</h3>
          <!-- Display the ToC for the current document if it is not empty. -->
          <ul class='current'>
<li class='current'><a class="reference internal" href="#">Differentiable pulse programming with qubits in PennyLane</a><ul class='current'>
<li class='current'><a class="reference internal" href="#pulses-in-quantum-computers">Pulses in quantum computers</a></li>
<li class='current'><a class="reference internal" href="#pulse-programming-in-pennylane">Pulse programming in PennyLane</a></li>
<li class='current'><a class="reference internal" href="#gradients-of-pulse-programs">Gradients of pulse programs</a></li>
<li class='current'><a class="reference internal" href="#piecewise-constant-parametrizations">Piecewise-constant parametrizations</a></li>
<li class='current'><a class="reference internal" href="#variational-quantum-eigensolver-with-pulse-programming">Variational quantum eigensolver with pulse programming</a></li>
<li class='current'><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class='current'><a class="reference internal" href="#references">References</a></li>
<li class='current'><a class="reference internal" href="#about-the-author">About the author</a></li>
</ul>
</li>
</ul>

        
    </div>

    <div class="xanadu-call-to-action-links">
        <h3>Downloads</h3>
        <div id="tutorial-type">demos/tutorial_pulse_programming101</div>
        <div class="download-python-link">
            <i class="fab fa-python"></i>&nbsp;
            <div class="call-to-action-desktop-view">Download Python script</div>
        </div>
        <div class="download-notebook-link">
            <i class="fas fa-download"></i>&nbsp;
            <div class="call-to-action-desktop-view">Download Notebook</div>
        </div>
        <div class="github-view-link">
            <i class="fab fa-github"></i>&nbsp;
            <div class="call-to-action-desktop-view">View on GitHub</div>
        </div>
    </div>
    <div id="related-tutorials" class="mt-4">
      <h3> Related</h3>
    </div>
  </div>
</div>


    
          <div class="up-button">
            
              
                <a href="../demos_quantum-computing.html"><i class="fas fa-angle-double-left"></i></a>
              
            
          </div>

          <div class="clearfix"></div>
        </div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_neutral_atoms.html" title="Neutral-atom quantum computers"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_zx_calculus.html" title="Introduction to the ZX-calculus"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PennyLane  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../demonstrations.html" >Demos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../demos_quantum-computing.html" >Quantum Computing</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Differentiable pulse programming with qubits in PennyLane</a></li> 
      </ul>
    </div>
  <script type="text/javascript">
    $("#mobile-toggle").click(function () {
      $("#left-column").slideToggle("slow");
    });
  </script>

  <!-- jQuery -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <!-- MathJax -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.10/js/mdb.min.js"></script>
  <!-- NanoScroller -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nanoscroller/0.8.7/javascripts/jquery.nanoscroller.min.js"></script>
  <!-- Syntax Highlighting -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

  <script type="text/javascript">
    $("a.reference.internal").each(function(){
      var link = $(this).attr("href");

      var hash = link.split("#")[1];
      var page = link.split("#")[0].split("/").slice(-1)[0].replace(".html", "");

      if (hash == page) {
        $(this).attr("href", link.split("#")[0]);
      }
    });

    $(".document > .section").removeClass("section");
    $("h1 ~ .section").removeClass("section");
    $(".localtoc-container .nano-content").css("height", $("#content").height());
    $(".localtoc-container").css("height", $("#content").height());
    $(".nano").nanoScroller();
  </script>

  <script type="text/javascript">
      $(window).scroll(function(){
        var scrollBottom = $(document).height() - $(window).height() - $(window).scrollTop();
        if (scrollBottom < 342) {
          $(".localtoc-container").css("height", "calc(100% - " + (342 - scrollBottom) + "px)");
          $(".localtoc-container .nano-content").css("height", "calc(100% - 119px)");
        }
      });
  </script>

  <script type="text/javascript">
    if ($(".current").length) {
      var target = $(".current")[0]
      var rect = target.getBoundingClientRect();
      if (rect.bottom > window.innerHeight) {
          $(".nano").nanoScroller({ scrollTo: $(".current") });
      } else {
          $(".nano").nanoScroller({ scrollTop: 0 });
      }
    }
    $(document).ready(function () {
        $(".css-transitions-only-after-page-load").each(function (index, element) {
            setTimeout(function () { $(element).removeClass("css-transitions-only-after-page-load") }, 10);
        });
        if (window.location.hash) {
          var target = $("[id='" + window.location.hash.substr(1) + "']");
          if (target.closest(".collapse").length) {
            target.closest(".collapse").addClass("show");
            target.closest(".collapse").prev().find(".rotate").addClass("up");
          }
        }
    });
  </script>

    <script type="text/javascript">
    var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
    if (downloadNote.length >= 1) {
      var tutorialUrlArray = $("#tutorial-type").text().split('/');

      if (tutorialUrlArray[0] == "demos") {
        tutorialUrlArray[0] = "demonstrations";
      }

      var githubLink = "https://github.com/" + "PennyLaneAI/qml" + "/blob/master/" + tutorialUrlArray.join("/") + ".py",
          pythonLink = $(".sphx-glr-download .reference.download")[0].href,
          notebookLink = $(".sphx-glr-download .reference.download")[1].href;

      $(".download-python-link").wrap("<a href=" + pythonLink + " data-behavior='call-to-action-event' data-response='Download Python script' download target='_blank'/>");
      $(".download-notebook-link").wrap("<a href=" + notebookLink + " data-behavior='call-to-action-event' data-response='Download Notebook' download target='_blank'/>");
      $(".github-view-link").wrap("<a href=" + githubLink + " data-behavior='call-to-action-event' data-response='View on Github' target='_blank'/>");
      $("#right-column").addClass("page-shadow");
    } else {
      $(".xanadu-call-to-action-links").hide();
      $("#bottom-dl").attr('style','display: none !important');
    }
    </script>

    <script type="text/javascript">
      function makeUL(urls, text) {
          var list = document.createElement('ul');

          for (var i = 0; i < urls.length; i++) {
              var item = document.createElement('li');
              var a = document.createElement('a');
              var linkText = document.createTextNode(text[i]);
              a.appendChild(linkText);
              a.href = urls[i];
              item.appendChild(a);
              list.appendChild(item);
          }
          return list;
      }

      if (typeof related_tutorials !== 'undefined') {
          document.getElementById('related-tutorials').appendChild(makeUL(related_tutorials, related_tutorials_titles));
          $("#related-tutorials ul li a").append(' <i class="fas fa-angle-double-right" style="font-size: smaller;"></i>')
          $("#related-tutorials").show();

    } else {
          $("#related-tutorials").hide();
    }
    </script>

  <!-- Account for MathJax when navigating to anchor tags. -->
  <script type="text/javascript">
    function scrollToElement(e) {
      // Scrolls to the given element, taking into account the navbar.
      MathJax.Hub.Queue(function() {
        // The following MUST be done asynchronously to take effect.
        setTimeout(function() {
          const navbar = document.querySelector("nav.navbar");
          const navbarHeight = navbar ? navbar.offsetHeight : 0;
          const scrollToY = e.offsetTop + e.offsetParent.offsetTop - navbarHeight;
          window.scrollTo(0, scrollToY);
        }, 0);
      });
    }

    function scrollToFragment(fragment) {
      // Scrolls to the position of the given URL fragment (which includes the "#").
      const elementID = fragment.replace(".", "\\.");
      if (elementID !== "") {
        const element = document.querySelector(elementID);
        if (element !== null) {
          scrollToElement(element);
        }
      }
    }

    $(document).ready(() => {
      scrollToFragment(window.location.hash);
      window.addEventListener("popstate", (_) => scrollToFragment(document.location.hash), false);
    });
  </script>

  <!-- Hide the rendering of :orphan: metadata. -->
  <script type="text/javascript">
    $(document).ready(() => {
      const elements = document.getElementsByClassName("field-odd");
      for (const element of elements) {
          if (element.innerHTML.trim() === "orphan") {
            element.style.display = "none";
          }
      }
    });
  </script>

  <script type="text/javascript">
    jQuery.noConflict(true);
  </script>

  

<footer class="page-footer text-md-left pt-4">

  <hr class="pb-0 mb-0">
  <div class="container-fluid">
    <div class="row justify-content-md-center">

      
      <!-- About -->
      <div class="col-md-4">
        <h5 class="mb-1 footer-heading">PennyLane</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <p>        PennyLane is an open-source software framework for quantum
        machine learning, quantum chemistry, and quantum computing, 
        with the ability to run on all hardware.
        Maintained with ❤️ by Xanadu.
        </p>
      </div>
      

      <!-- Links -->
      
      <div class="col-md-2 col-4">
        <h5 class="mb-1 footer-heading">PennyLane</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <ul class="list-unstyled">
          
          <li><a href="https://pennylane.ai/">Home</a></li>
          
          <li><a href="https://pennylane.ai/qml">Learn</a></li>
          
          <li><a href="https://pennylane.ai/qml/demonstrations.html">Demonstrations</a></li>
          
          <li><a href="https://docs.pennylane.ai/">Documentation</a></li>
          
          <li><a href="https://github.com/PennyLaneAI/pennylane">GitHub</a></li>
          
          <li><a href="https://twitter.com/pennylaneai">Twitter</a></li>
          
          <li><a href="https://pennylane.ai/blog">Blog</a></li>
          
        </ul>
      </div>
      
      <div class="col-md-2 col-4">
        <h5 class="mb-1 footer-heading">Xanadu</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <ul class="list-unstyled">
          
          <li><a href="https://xanadu.ai/">Home</a></li>
          
          <li><a href="https://xanadu.ai/about/">About</a></li>
          
          <li><a href="https://xanadu.ai/photonics">Hardware</a></li>
          
          <li><a href="https://xanadu.ai/careers/">Careers</a></li>
          
          <li><a href="https://cloud.xanadu.ai">Cloud</a></li>
          
          <li><a href="https://discuss.pennylane.ai/">Forum</a></li>
          
          <li><a href="https://xanadu.ai/blog">Blog</a></li>
          
        </ul>
      </div>
      

    </div>
  </div>
  <hr>

  <!-- Social -->
  <div class="social-section text-center">
      <ul class="list-unstyled list-inline mb-0">
          
          <li class="list-inline-item"><a class="btn-git" href="https://twitter.com/PennyLaneAI"><i class="fab fa-twitter"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://github.com/PennyLaneAI/pennylane"><i class="fab fa-github"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://linkedin.com/company/xanaduai/"><i class="fab fa-linkedin-in"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://discuss.pennylane.ai"><i class="fab fa-discourse"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://xanadu-quantum.slack.com/join/shared_invite/zt-nkwn25v9-H4hituCb_PUj4idG0MhSug#/shared-invite/email"><i class="fab fa-slack"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://pennylane.ai/blog/"><i class="fas fa-rss"> </i></a></li>
          
      </ul>
      
        
          <a href="https://xanadu.us17.list-manage.com/subscribe?u=725f07a1d1a4337416c3129fd&id=294b062630" style="font-size: initial;">
            Stay updated with our newsletter
          </a>
        
      
  </div>

  <!-- Copyright -->
  <div class="footer-copyright py-3 mt-0 text-center">
      <div class="container-fluid">
            Copyright &copy; 2022, Xanadu Quantum Technologies, Inc.

        
          <br>
          TensorFlow, the TensorFlow logo, and any related marks are trademarks of Google Inc.
        
      </div>
  </div>
</footer>
  </body>
</html>